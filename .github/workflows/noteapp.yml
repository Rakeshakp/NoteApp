name: Send Test Report

on:
  workflow_run:
    workflows: ["Run Tests"]  # Replace with your actual test workflow name
    types:
      - completed

jobs:
  send-email:
    runs-on: ubuntu-latest
    env:
      SUBJECT: ${{ github.event.workflow_run.conclusion == 'success' && 'Test Passed: GitHub Actions Report' || 'Test Failed: GitHub Actions Report' }}
    steps:
      - name: Download artifacts
        uses: actions/download-artifact@v3
        with:
          name: test-report
          path: reports

      - name: Send email with report
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.office365.com
          server_port: 587
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: ${{ env.SUBJECT }}
          to: rakeshkp668@gmail.com
          from: ${{ secrets.EMAIL_USERNAME }}
          body: |
            Hello,

            The latest test run has ${{ github.event.workflow_run.conclusion }}.
            Please find the attached report files.

            Regards,  
            GitHub Actions
          attachments: |
            reports/log.html
            reports/report.html
            reports/output.xml
